오케스트레이션은 [계획 - 실행]의 구조로 한다.

0. 개요
  - 기능은 크게 두가지로 분류된다. LLM을 활용한 기능, 그외의 기능(TOOL)의 두가지로 구분한다. 
  - TOOL은 내부(Built-In) Tools, Plug-In Tools, MCP Tools로 다시 3가지로 구분된다.
  - LLM을 활용하는 기능은 Plan, Chat, Tool Parameter setting, Analyze, Summary, Visualize(web), User Response 등으로 상세하게 정의될 것이다.
  - 이 두가지 요소에 대해서는 별도로 상세히 정의하는 것으로 한다.
  - 여기에서는 이 두가지 기능을 활용한 오케스트레이션에 대한 정의를 한다.
  - LLM Plan기능이 본 오케스트레이션의 핵심이다.

1. LLM Plan 기능
  - 기능 개요 : LLM은 사용자의 입력을 받아서, 요구사항을 분석하고, 계획을 수립한다.
  - 최초 계획이 수립되고, 수립된 계획에 따라서 단일(혹은 다수의) 기능(들)이 수행되고, 다시 계획 단계에서 다음 스텝을 결정하는 방식으로 진행된다.
  - 계획 단계에서는 다양한 기능을 사용하는 것도 가능하며, 계획을 세우지 않고, 즉시 사용자에게 응답을 하는 것도 가능하다.
  - 단순 응답의 경우는 계획 후 즉시 사용자에게 응답을 할 수 있으나, 기능들이 수행된 이후에는 가능하면 응답 전문 LLM을 계획하여 진행하도록 해야 한다.
  - 각 기능은 프롬프트에 필요한 항목들이 추가되어야 하는데, 특히 Plan단계에서는 반드시 모든 기능(LLM 및 TOOL)에 대한 설명(Description)이 포함되어야 한다.
  - 그 외에도 각 LLM의 기능에는 해당하는 요소들이 치환될 수 있도록 해야 한다. 이것의 방법은 가능하면 유연하고, 우아한 방식이어야 한다.

2. LLM 기능 호출
  - LLM은 위에서 언급한 것처럼 다양한 기능으로 분류된다.
  - 각 LLM은 고유한 프롬프트를 가지게 된다. 이것은 설정파일로 관리될 것이다.
  - 프롬프트에는 치환 가능한 요소들이 있으며, 이런한 요소들은 LLM이 호출될 때 파라미터로 주입되어야 한다.
  - 하지만 다양한 종류의 파라미터를 유연하게 주입하는 방법에 대해서는 추가적인 고민이 필요하다.
  - 그리고 각 LLM 기능들은 모두 실제 어떤 모델(gpt? claude? loacal llm?)을 호출할 것인지는 설정으로 관리되어야 한다.
  - 오케스트레이션의 입장에서는 어떤 모델을 사용하는지 알 필요가 없다. 또한 어떤 프롬프트를 쓰는지도 몰라도 된다. 이것은 LLM 기능을 관리하는 클래스 내부에서 처리될 것이다.
  - 오케스트레이션에서는 LLM 기능의 종류가 선택되면 그것과, 치환이 필요한 요소(이것은 유연한 Dictionary 방식)만 파라미터로 주입하면 된다.
  - 다만 중요한 것은 다양한 LLM의 종류가 있지만, if-else 조건 분기하는 방식은 아니어야 한다. 확장가능한 방식이 되기 위해서는 유연한 확장이 가능한 구조여야 한다.
  - 중요한 포인트 중 하나는 LLM의 응답은 반드시 구조화된 응답이어야 한다.(사용자 최종 응답을 제외하고) 이것은 프롬프트에 정의가 되어 있어야 한다.

3. TOOL 기능 호출
  - TOOL은 위에서 언급한 것처럼 총 3가지로 구분된다.
  - 하지만 총 3가지 모두 Tool의 이름과, 설명(Description)을 가진 방식이어야 한다. 이것은 LLM의 기능들도 마찬가지다.
  - 기능이 잘 설명되어야 Plan LLM이 좋은 계획을 수립할 수 있다.
  - 첫번째 종류는 내부(Built-In) Tools 이고, 이것은 Agent를 구성하는데 필수적인 요소들이다. 아마 Memory 같은 것들이 여기에 해당될 것이다. 상세사항은 다시 검토해야 한다.
  - 두번째 종류는 Pulg-In Tools이고, 유연하게 확장 가능하도록 구현되어야 한다. 리플렉션을 활용할 것이다. 
  - 세번째 종류는 MCP Tools이고, 이것은 MCP 표준을 따라야 한다.
  - Tool 호출은 경우에는 크게 두가지로 구분할 수 있다. 파라미터가 없는 Tool과 파라미터가 있는 Tool이다.
  - 파라미터가 있는 Tool의 경우는 LLM의 파라미터를 결정하는 작업을 진행되어야 한다.

4. 오케스트레이션의 완료
  - LLM의 종류 중 완료에 해당하는 기능(chat, response 등)이 수행되면 완료되는 것으로 처리되도록 해야 한다.
  - 이것도 마찬가지로 if-else 조건 분기보다는 우아한 방식으로 처리될 수 있도록 구현해야 확장성이 있을 것이다.

5. 추가 요소
  - 본 정의에서는 스트리밍 응답에 대해서는 반영하지 않았는데, 먼저 기본 응답을 먼저 구현하고자 한다.
  - 이후 기본 응답에 대한 구조가 완성되면, 스트리밍 응답을 지원되도록 구현되어야 한다.
  - LLM의 응답이나, 도구의 응답의 Result구조는 통일하는 것이 필요할 것이다.